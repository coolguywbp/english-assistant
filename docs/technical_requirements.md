# English Assistant ТЗ

TODOS:

- [x] Рассмотреть предложение убрать виджет **Pending**. Возможно если всё будет просто в **Calls** будет лучше? -> **да**
- [x] Определиться какие практики (все?) будут в начальной версии (слова, произношение, предложения) -> **слова, произношение**
- [x] Описать какие действия доступны учителю во время урока (Lesson Flow)
- [x] Описать как выбирается учитель для пробного урока -> **виджет ChooseTeacher**
- [ ] Решить что с тарифами? Какие будут тарифы? Чем будут отличаться? ЧТо будет если ученик решает сменить тариф?
- [ ] Проверить функционал блока [**Account**](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#238-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BA-%D0%B8-%D0%BB%D0%B8%D1%87%D0%BD%D0%BE%D0%B9-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-account)
- [ ] Описать функционал блока [**List**](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#236-%D0%BF%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80-%D0%B8-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%B2-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9-list)
- [ ] Описать функционал блока [**Practice**](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#235-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B9-practice)
- [ ] Как выплачивать учителям? (юридически)
- [ ] Описать как назначаются и проводятся собеседования для учителей
- [ ] **Макет**: отрисовать все [виджеты](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#24-%D0%B2%D0%B8%D0%B4%D0%B6%D0%B5%D1%82%D1%8B)

## 1. Цель проекта

Цель проекта — разработать Telegram бота, предназначенного для изучения английского языка (далее **Бот**). Ученики смогут общаться с разговорным искуственным интеллектом, записываться на занятия к учителям, получать задания и выполнять их.

## 2. Описание системы

1. [Типы пользователей](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#21-%D1%82%D0%B8%D0%BF%D1%8B-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9)
2. [Разговорный ИИ](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#22--%D1%80%D0%B0%D0%B7%D0%B3%D0%BE%D0%B2%D0%BE%D1%80%D0%BD%D1%8B%D0%B9-%D0%B8%D0%B8)
3. [Функциональные блоки](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#23-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8)
4. [Виджеты](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#24-%D0%B2%D0%B8%D0%B4%D0%B6%D0%B5%D1%82%D1%8B)

### 2.1 Типы пользователей

В системе существуют 3 типа пользователей: **Ученик**, **Учитель** и **Администратор**.

#### Ученик может

1. Общаться с разговорным ИИ
2. Выбирать тарифы и оплачивать занятия
3. Записываться на уроки к учителям и получать напоминания
4. Получать от учителя задания и выполнять их

#### Учитель может

1. Получать заявки на проведения занятий
2. Управлять своим расписанием
3. Давай задания ученикам
4. Получать деньги за проведение уроков

#### Администратор может

1. Редактировать данные пользователей
2. Управлять расписанием
3. Добавлять в систему новых учителей
4. Оказывать поддержку ученикам и учителям

### 2.2  Разговорный ИИ

Система использует софт для обработки естественного языка (NLP) - [Rasa Open Source](https://rasa.com/open-source/) (далее **Rasa**).

Пользователи могу общаться с **Ботом** в свободном режиме с помощью текстовых и голосовых сообщений. **Бот** распознает намерение (**intent**) и входную информацию (**entities**), отвечает либо текстовым сообщением (**response**), либо вызовом необходимых действий (**action**).

Модель, используемая **Rasa** обучена на распознавание русского и английского языков.

Таким образом можно вызывать основные функции заложенные в систему. Некоторые функции дублируются Reply-кнопками.

### 2.3 Функциональные блоки

1. [Добавление учителей и админов в систему (**Lobby**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#231-%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D1%83%D1%87%D0%B8%D1%82%D0%B5%D0%BB%D0%B5%D0%B9-%D0%B8-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2-%D0%B2-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%83-lobby)
2. [Поддержка учеников и учителей (**Support**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#232-%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%B0-%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%BA%D0%BE%D0%B2-%D0%B8-%D1%83%D1%87%D0%B8%D1%82%D0%B5%D0%BB%D0%B5%D0%B9-support)
3. [Запись на уроки и ведение расписаний (**Calls**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#233-%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8C-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%BA%D0%B8-%D0%B8-%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D1%80%D0%B0%D1%81%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B9-calls)
4. [Проверка заданий и проведение уроков (**Lesson Flow**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#234-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B9-%D0%B8-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D1%83%D1%80%D0%BE%D0%BA%D0%BE%D0%B2-lesson-flow)
5. [Получение и выполнение заданий (**Practice**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#235-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B9-practice)
6. [Просмотр и редактирование списков пользователей (**List**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#236-%D0%BF%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80-%D0%B8-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%B2-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9-list)
7. [Оплата тарифов и выплата вознаграждений (**Payment**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#237-%D0%BE%D0%BF%D0%BB%D0%B0%D1%82%D0%B0-%D1%82%D0%B0%D1%80%D0%B8%D1%84%D0%BE%D0%B2-%D0%B8-%D0%B2%D1%8B%D0%BF%D0%BB%D0%B0%D1%82%D0%B0-%D0%B2%D0%BE%D0%B7%D0%BD%D0%B0%D0%B3%D1%80%D0%B0%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B9-payment)
8. [Редактирование настроек и личной информации (**Account**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#238-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BA-%D0%B8-%D0%BB%D0%B8%D1%87%D0%BD%D0%BE%D0%B9-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-account)
9. [Панель администратора (**Admin Panel**)](https://github.com/coolguywbp/english-assistant/blob/main/docs/technical_requirements.md#239-%D0%BF%D0%B0%D0%BD%D0%B5%D0%BB%D1%8C-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%B0-admin-panel)

### 2.3.1 Добавления учителей и администраторов в систему (Lobby)

**Lobby** - это канал, в котором состоят все учителя и администраторы.

**Администратор**, проводивший собеседование **Учителю** может добавить его в этот канал.

Факт нахождения пользователя в **Lobby** делает его учителем в системе.

Если пользователь является администратором в **Lobby**, то он является **Администратором** в системе.

### 2.3.2 Поддержка учеников и учителей (Support)

В случае возникновения спорных ситуаций **Rasa** вызывает **action**, корорый триггерит создание поста (**issue**) в канале поддержки (**Support Channel**).

Комментарии **Администраторов** под этим постом пересылаются пользователям в **Боте**.

**Администратор** может изменить расписание и личную информацию пользователя, если посчитает, что это решит возникшую проблему.

### 2.3.3 Запись на уроки и ведение расписаний (Calls)

**Урок** - это звонок между учителем и учеником. Длительность урока определяется выбранным тарифом.

Расписание доступно в виджете **ShowCalls**.

Урок может иметь один из 5 статусов:

1. *Pending* - ожидание подтверждения
2. *Accepted* - принят
3. *Going* - идет в данный момент
4. *Cancelled* - отменен
5. *Finished* - окончен

В случае, если ученик записывается на свой первый урок (пробный), **Бот** уточняет его текущее время для определения часового пояса.

После того как **Ученик** сообщил о желании записаться на урок, запускается виджет **ChooseDate**, чтобы выбрать дату и время. В нем отображается время, доступное для записи.

После выбора даты и времени **Ученику** приходит уведомление о том,что запрос принят и урок находится в статусе *Pending*.

После подтверждения запроса **Учителем**, **Ученик** получает уведомление от том что урок в статусе *Accepted*.

#### Инициация урока

В момент начала урока у **Учителя** спрашивается удалось ли начать урок (**ДА/НЕТ**).

- Если ответ **НЕТ**, то уточняется причина и производится соответствующее действие:

  - *Приватный аккаунт* - **Ученику** сообщается, что **Учитель** не может звонить закрытым аккаунтам, **Ученику** даётся контакт **Учителя** и предлагается позвонить
  - *Не отвечает* - **Ученику** сообщается, что не удается дозвониться, оповещается  **Администратор**
  - *Отменил урок* - сценарий предполагает что **Учитель** дозвонился, но **Ученик** сказал что не может быть на уроке. В таком случае ситуация аналогична описанному выше, оповещается  **Администратор**

- Если ответ **ДА**:
  
  Урок начинается, **Бот** переходит в режим **Lesson Flow**

### 2.3.4 Проверка заданий и проведение уроков (Lesson Flow)

#### Проверка заданий

Как только начался **Lesson Flow** - **Бот** отправляет **Учителю** отчет о пройденной практике.

1. Выводятся слова с неверно введенным текстовым переводом
2. Выводятся предложения составленные учеником
3. При несоответствии произношения сообщения, слово в которое не смогло распознать приложение
4. Коментарий к уроку оставленный прошлым учителем

#### Во время урока

Во время урока **Учителю** доступны следующие Reply-кнопки:

- Завершить урок -> завершает урок раньше положенного времени
- Добавить слово -> отсылает слово **Ученику** и добавляет в словарь

#### Завершение урока

За 5 минут до конца урока **Учитель** оповещается.

После окончания урок, **Бот** переходит в нормальный режим работы.

#### Добавление заданий

**Учителю** предлагается добавить ученику задания. Используются виджеты из блока **Practice**.

#### Тема следующего урока

На данном этапе это просто коментарий к следующему уроку. В дальнейшем тут **Учитель** смог бы назначать тематические блоки.

#### Обратная связь от ученика

Через какое-то время после окончания урока **Бот** спрашивает у ученика был ли у него урок и просит оценить по шкале от 1 до 5 (виджет **StudentFeedback**).

### 2.3.5 Получение и выполнение заданий (**Practice**)

**SOON**

### 2.3.6 Просмотр и редактирование списков пользователей (**List**)

**SOON**

### 2.3.7 Оплата тарифов и выплата вознаграждений (**Payment**)

После проведения пробного урока **Ученику** предлагается выбрать один из тарифов (**Plans**) и оплатить удобным способом. На данный момент рассматривается единственный вариант - оплата картой через эквайринг *???* | Вопрос: **Какой эквайринг?**

После оплаты, **Ученик** может начать назначать уроки.

Когда у **Ученика** заканчивается действие тарифа, возможность назначить урок пропадает.

За каждый урок **Учитель** получает фиксированную сумму на свой внутренний кошелек. В своём **Account** он может видеть баланс и историю поступлений. По достижению определенной суммы, **Учитель** может вывести деньги себе на карту.
| Вопрос: **Как это юридически сделать?**

Администратор может создавать и редактировать **Plans** через **Admin Panel**.

### 2.3.8 Редактирование настроек и личной информации (**Account**)

В виджете **ShowAccount** пользователи видят личную информацию.

Функционал **Ученика** и **Учителя** различается:

#### Ученик

##### Отображаемая информация (ученик)

- Имя
- Часовой пояс
- Баланс
- Выбранный тариф
- Учитель
  
##### Доступные действия (ученик)

- Выбрать и оплатить тариф -> виджет **ChoosePlan**
- Редактировать личный данные -> виджет **EditPersonalData**
- Поменять учителя -> виджет **ChooseTeacher**

#### Учитель

##### Отображаемая информация (учитель)

- Имя
- Часовой пояс
- Баланс
- Выбранный тариф
- Список учеников
  
##### Доступные действия (учитель)

- Редактировать личный данные -> виджет **EditPersonalData**
- Получить выплату -> виджет **GetReward**

### 2.3.9 Панель администратора (**Admin Panel**)

**Admin Panel** - это веб-приложение, доступное **Администраторам**. В нём можно редактировать расписание, личные данные и переписываться от лица бота.

### 2.4 Виджеты

**Виджеты** - это элементы пользовательского интерфейса, которые предназначены для удобного ввода/вывода информации.

- [ ] **ShowCalls**: просмотр и редактирование своего расписания.
  - **Ученик** видит свои *Accepted* и *Going* уроки, может назначать и отменять уроки
  - **Учитель** видит свои *Accepted*, *Pending* и *Going* уроки, может принимать и отменять уроки
  - **Администратор** видит *Accepted*, *Pending* и *Going* уроки, может отменять и переносить уроки (всех пользователей)

- [ ] **ChooseDate** -> выбор даты и времени среди предложенных вариантов (**Slots**)
- [ ] **ChooseTeacher** -> просмотр профилей и выбор учителя из **Pool**
- [ ] **StudentFeedback** -> обратная связь от студента по прошедшему уроку
- [ ] **ShowUsers** -> просмотр списков и выбор пользователя
- [ ] **ShowAccount** -> просмотр и редактирование личной информации и настроек
- [ ] **ChoosePlan** -> выбор тарифа
- [ ] **EditPersonalData** -> редактирование личных данных
- [ ] **GetReward** -> получение выплаты учителем

## 3. Предлагаемый стек технологий

Для реализации системы предлагается следующий стек технологий:

Telegram Bot:

- Python
- Aiogram
- Rasa Open Source

Backend:

- Python
- Django + REST framework
- PostgreSQL
  
Frontend:

- TypeScript
- Svelte + SvelteKit
